# 📊 파이프라인 개요 (Pipeline Overview)

## 1. 전체 파이프라인 흐름도

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              FAST FISH 데이터 파이프라인                                  │
│                         Product Mix Clustering & Rules Visualization                     │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                                    ┌──────────────┐
                                    │   Raw Data   │
                                    │   (원시 데이터)  │
                                    └──────┬───────┘
                                           │
                                           ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│  STEP 1: 데이터 로딩 (Data Loading)                                                       │
│  ─────────────────────────────────                                                       │
│  • 입력: CSV/Excel 원시 데이터 파일                                                        │
│  • 처리: 데이터 검증, 타입 변환, 결측치 처리                                                 │
│  • 출력: 정제된 DataFrame                                                                 │
│  • 파일: step1_load_data.py                                                              │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                           │
                                           ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│  STEP 2: 좌표 추출 (Coordinate Extraction)                                                │
│  ─────────────────────────────────────────                                               │
│  • 입력: Step 1의 정제된 데이터                                                            │
│  • 처리: 위도/경도 좌표 추출 및 검증                                                        │
│  • 출력: 유효한 좌표가 포함된 데이터                                                        │
│  • 파일: step2_extract_coordinates.py                                                    │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                           │
                                           ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│  STEP 3: 매트릭스 생성 (Matrix Creation)                                                  │
│  ─────────────────────────────────────────                                               │
│  • 입력: 좌표가 포함된 데이터                                                              │
│  • 처리: 제품 믹스 매트릭스 생성 (SPU/카테고리 레벨)                                         │
│  • 출력: 클러스터링용 피처 매트릭스                                                         │
│  • 파일: step3_create_matrix.py                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                           │
                              ┌────────────┴────────────┐
                              ▼                         ▼
┌─────────────────────────────────────┐   ┌─────────────────────────────────────┐
│  STEP 4: 최적 클러스터 수 결정         │   │  STEP 5: 클러스터 분석                 │
│  ───────────────────────────         │   │  ─────────────────                   │
│  • Elbow Method                      │   │  • K-Means 클러스터링                  │
│  • Silhouette Score                  │   │  • PCA 차원 축소                       │
│  • 최적 K 값 도출                     │   │  • 클러스터 프로파일링                  │
│  • 파일: step4_optimal_clusters.py   │   │  • 파일: step5_cluster_analysis.py    │
└─────────────────────────────────────┘   └─────────────────────────────────────┘
                              │                         │
                              └────────────┬────────────┘
                                           ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│  STEP 6: 확장 클러스터 분석 (Extended Cluster Analysis)                                    │
│  ─────────────────────────────────────────────────────                                   │
│  • 입력: Step 3의 매트릭스 + Step 4/5의 클러스터 결과                                       │
│  • 처리: SPU 레벨 클러스터링, 온도 인식 분석                                                │
│  • 출력: 상세 클러스터 분석 결과                                                           │
│  • 파일: step6_cluster_analysis.py                                                       │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                           │
                                           ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│  STEP 7: 규칙 생성 (Rule Generation)                                                      │
│  ─────────────────────────────────────                                                   │
│  • 입력: 클러스터 분석 결과                                                                │
│  • 처리: 클러스터별 제품 믹스 규칙 도출                                                     │
│  • 출력: JSON/CSV 형식의 규칙 파일                                                         │
│  • 파일: step7_generate_rules.py                                                         │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                           │
                                           ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│  STEP 8: 시각화 (Visualization)                                                          │
│  ───────────────────────────                                                             │
│  • 입력: 규칙 및 클러스터 데이터                                                           │
│  • 처리: 인터랙티브 차트 및 대시보드 생성                                                   │
│  • 출력: HTML/PNG 시각화 파일                                                             │
│  • 파일: step8_visualize_rules.py                                                        │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                           │
                                           ▼
                                    ┌──────────────┐
                                    │ Final Output │
                                    │  (최종 결과물)  │
                                    └──────────────┘
```

---

## 2. 데이터 흐름 (Data Flow)

### 2.1 입력 데이터 (Input Data)

| 데이터 유형 | 형식 | 설명 |
|------------|------|------|
| 매장 데이터 | CSV | 매장 ID, 위치, 특성 정보 |
| 판매 데이터 | CSV | 제품별 판매량, 매출 정보 |
| 제품 마스터 | CSV | SPU/카테고리 정보 |
| 좌표 데이터 | CSV | 위도/경도 정보 |

### 2.2 중간 산출물 (Intermediate Outputs)

| Step | 산출물 | 형식 | 위치 |
|------|--------|------|------|
| Step 1 | 정제된 데이터 | Parquet/CSV | `output/step1/` |
| Step 2 | 좌표 데이터 | CSV | `output/step2/` |
| Step 3 | 피처 매트릭스 | CSV/NPY | `output/step3/` |
| Step 4 | 최적 K 분석 | JSON/PNG | `output/step4/` |
| Step 5 | 클러스터 결과 | CSV | `output/step5/` |
| Step 6 | 상세 분석 | CSV/JSON | `output/step6/` |

### 2.3 최종 산출물 (Final Outputs)

| 산출물 | 형식 | 설명 |
|--------|------|------|
| 클러스터 규칙 | JSON | 클러스터별 제품 믹스 규칙 |
| 규칙 요약 | CSV | 규칙 요약 테이블 |
| 시각화 | HTML/PNG | 인터랙티브 대시보드 |
| 보고서 | PDF/MD | 분석 결과 보고서 |

---

## 3. 핵심 개념 (Key Concepts)

### 3.1 SPU (Stock Keeping Unit)
- **정의**: 개별 제품 식별 단위
- **용도**: 세분화된 제품 믹스 분석
- **예시**: 특정 브랜드의 특정 용량 제품

### 3.2 제품 믹스 매트릭스 (Product Mix Matrix)
- **정의**: 매장별 제품 구성 비율을 나타내는 행렬
- **행**: 매장 (Store)
- **열**: 제품/카테고리 (SPU/Category)
- **값**: 판매 비율 또는 수량

### 3.3 클러스터링 (Clustering)
- **알고리즘**: K-Means
- **목적**: 유사한 제품 믹스를 가진 매장 그룹화
- **결과**: 클러스터별 특성 프로파일

### 3.4 규칙 (Rules)
- **정의**: 클러스터별 권장 제품 구성
- **형식**: IF-THEN 규칙 또는 비율 기반 권장
- **용도**: 매장 최적화, 신규 매장 구성 가이드

---

## 4. 기술 스택 (Technology Stack)

| 구분 | 기술 | 버전 |
|------|------|------|
| 언어 | Python | 3.8+ |
| 데이터 처리 | pandas/fireducks | Latest |
| 수치 연산 | NumPy | Latest |
| 머신러닝 | scikit-learn | Latest |
| 시각화 | matplotlib, plotly | Latest |
| 진행률 표시 | tqdm | Latest |

---

## 5. 실행 방법 (Execution)

### 5.1 순차 실행 (Sequential)
```bash
# 각 Step을 순서대로 실행
python src/step1_load_data.py
python src/step2_extract_coordinates.py
python src/step3_create_matrix.py
python src/step4_optimal_clusters.py
python src/step5_cluster_analysis.py
python src/step6_cluster_analysis.py
python src/step7_generate_rules.py
python src/step8_visualize_rules.py
```

### 5.2 파이프라인 실행 (Pipeline)
```bash
# 전체 파이프라인 한 번에 실행 (구현 시)
python run_pipeline.py --all
```

---

## 6. 다음 문서

- [02_STEP1_DATA_LOADING.md](./02_STEP1_DATA_LOADING.md) - Step 1 상세 설명
