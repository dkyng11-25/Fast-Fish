# ğŸ“ Step 2: ì¢Œí‘œ ì¶”ì¶œ (Coordinate Extraction)

## 1. ê°œìš” (Overview)

### 1.1 ëª©ì 
ë§¤ì¥ ë°ì´í„°ì—ì„œ ìœ„ë„/ê²½ë„ ì¢Œí‘œë¥¼ ì¶”ì¶œí•˜ê³  ìœ íš¨ì„±ì„ ê²€ì¦í•©ë‹ˆë‹¤.

### 1.2 íŒŒì¼ ìœ„ì¹˜
- **ì†ŒìŠ¤ ì½”ë“œ**: `src/step2_extract_coordinates.py`
- **ì¶œë ¥ ìœ„ì¹˜**: `output/step2/`

---

## 2. ì…ë ¥ (Input)

### 2.1 ì…ë ¥ ë°ì´í„°

| ì†ŒìŠ¤ | íŒŒì¼ | í•„ìˆ˜ ì»¬ëŸ¼ |
|------|------|-----------|
| Step 1 ì¶œë ¥ | `cleaned_stores.csv` | store_id, latitude, longitude |

### 2.2 ì¢Œí‘œ ë°ì´í„° í˜•ì‹

```csv
store_id,store_name,latitude,longitude,address
S001,ë§¤ì¥A,37.5665,126.9780,ì„œìš¸ì‹œ ì¤‘êµ¬
S002,ë§¤ì¥B,35.1796,129.0756,ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬
```

---

## 3. ì²˜ë¦¬ ë¡œì§ (Processing Logic)

### 3.1 ì²˜ë¦¬ íë¦„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1 ì¶œë ¥ ë°ì´í„°   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ì¢Œí‘œ ì»¬ëŸ¼ ì‹ë³„                    â”‚
â”‚  â€¢ latitude/longitude ì»¬ëŸ¼ íƒìƒ‰      â”‚
â”‚  â€¢ lat/lon, ìœ„ë„/ê²½ë„ ë“± ë³„ì¹­ ì²˜ë¦¬    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ì¢Œí‘œ ì¶”ì¶œ (Extraction)           â”‚
â”‚  â€¢ ìˆ«ìí˜• ë³€í™˜                       â”‚
â”‚  â€¢ ë¬¸ìì—´ íŒŒì‹± (í•„ìš”ì‹œ)              â”‚
â”‚  â€¢ ê²°ì¸¡ì¹˜ ì‹ë³„                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ì¢Œí‘œ ê²€ì¦ (Validation)           â”‚
â”‚  â€¢ ìœ„ë„: -90 ~ +90                  â”‚
â”‚  â€¢ ê²½ë„: -180 ~ +180                â”‚
â”‚  â€¢ í•œêµ­ ë²”ìœ„ ê²€ì¦ (ì„ íƒì )           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ì´ìƒì¹˜ ì²˜ë¦¬ (Outlier Handling)   â”‚
â”‚  â€¢ ë²”ìœ„ ì™¸ ì¢Œí‘œ í”Œë˜ê·¸               â”‚
â”‚  â€¢ ë³´ì • ë˜ëŠ” ì œì™¸ ì²˜ë¦¬               â”‚
â”‚  â€¢ ë¡œê·¸ ê¸°ë¡                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ê²€ì¦ëœ ì¢Œí‘œ ë°ì´í„°   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ì¢Œí‘œ ê²€ì¦ ê·œì¹™

```python
# ì „ì—­ ì¢Œí‘œ ë²”ìœ„
GLOBAL_BOUNDS = {
    "latitude": (-90.0, 90.0),
    "longitude": (-180.0, 180.0)
}

# í•œêµ­ ì¢Œí‘œ ë²”ìœ„ (ì„ íƒì  ê²€ì¦)
KOREA_BOUNDS = {
    "latitude": (33.0, 43.0),
    "longitude": (124.0, 132.0)
}

def validate_coordinates(lat: float, lon: float) -> bool:
    """
    ì¢Œí‘œ ìœ íš¨ì„±ì„ ê²€ì¦í•©ë‹ˆë‹¤.
    
    Args:
        lat: ìœ„ë„
        lon: ê²½ë„
        
    Returns:
        ìœ íš¨ì„± ì—¬ë¶€
    """
    if lat is None or lon is None:
        return False
    if not (GLOBAL_BOUNDS["latitude"][0] <= lat <= GLOBAL_BOUNDS["latitude"][1]):
        return False
    if not (GLOBAL_BOUNDS["longitude"][0] <= lon <= GLOBAL_BOUNDS["longitude"][1]):
        return False
    return True
```

---

## 4. ì¶œë ¥ (Output)

### 4.1 ì¶œë ¥ íŒŒì¼

| íŒŒì¼ëª… | í˜•ì‹ | ì„¤ëª… |
|--------|------|------|
| `stores_with_coordinates.csv` | CSV | ìœ íš¨í•œ ì¢Œí‘œê°€ í¬í•¨ëœ ë§¤ì¥ ë°ì´í„° |
| `invalid_coordinates.csv` | CSV | ë¬´íš¨í•œ ì¢Œí‘œ ë ˆì½”ë“œ (ê²€í† ìš©) |
| `coordinate_stats.json` | JSON | ì¢Œí‘œ ì¶”ì¶œ í†µê³„ |

### 4.2 í†µê³„ êµ¬ì¡°

```json
{
    "total_stores": 1000,
    "valid_coordinates": 985,
    "invalid_coordinates": 15,
    "missing_coordinates": 10,
    "out_of_range": 5,
    "validation_rate": 0.985,
    "processing_time_seconds": 12.5
}
```

---

## 5. ì‹œê°í™” (Visualization)

### 5.1 ì¢Œí‘œ ë¶„í¬ ë§µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    í•œêµ­ ì§€ë„                             â”‚
â”‚                                                         â”‚
â”‚                        â—â—â—                              â”‚
â”‚                       â—â—â—â—â—  â† ì„œìš¸/ê²½ê¸° í´ëŸ¬ìŠ¤í„°         â”‚
â”‚                        â—â—                               â”‚
â”‚                                                         â”‚
â”‚                    â—                                    â”‚
â”‚                   â—â—â—  â† ëŒ€ì „/ì¶©ì²­ í´ëŸ¬ìŠ¤í„°               â”‚
â”‚                    â—                                    â”‚
â”‚                                                         â”‚
â”‚                  â—â—â—â—                                   â”‚
â”‚                 â—â—â—â—â—â—  â† ë¶€ì‚°/ê²½ë‚¨ í´ëŸ¬ìŠ¤í„°              â”‚
â”‚                  â—â—â—                                    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ì—ëŸ¬ ì²˜ë¦¬ (Error Handling)

### 6.1 ì˜ˆìƒ ì—ëŸ¬

| ì—ëŸ¬ ìœ í˜• | ì›ì¸ | ì²˜ë¦¬ ë°©ë²• |
|-----------|------|-----------|
| MissingColumnError | ì¢Œí‘œ ì»¬ëŸ¼ ì—†ìŒ | ëŒ€ì²´ ì»¬ëŸ¼ëª… íƒìƒ‰ |
| InvalidCoordinateError | ë²”ìœ„ ì™¸ ê°’ | í”Œë˜ê·¸ í›„ ë³„ë„ ì €ì¥ |
| ParseError | ë¬¸ìì—´ íŒŒì‹± ì‹¤íŒ¨ | ë¡œê·¸ ê¸°ë¡ í›„ ìŠ¤í‚µ |

### 6.2 ì—ëŸ¬ ë³µêµ¬ ì „ëµ

```python
# ì¢Œí‘œ ì»¬ëŸ¼ ë³„ì¹­ ë§¤í•‘
COLUMN_ALIASES = {
    "latitude": ["lat", "ìœ„ë„", "y", "LAT", "Latitude"],
    "longitude": ["lon", "lng", "ê²½ë„", "x", "LON", "Longitude"]
}

def find_coordinate_columns(df: pd.DataFrame) -> Tuple[str, str]:
    """
    ì¢Œí‘œ ì»¬ëŸ¼ì„ ì°¾ìŠµë‹ˆë‹¤.
    
    Returns:
        (latitude_column, longitude_column) íŠœí”Œ
    """
    lat_col = None
    lon_col = None
    
    for col in df.columns:
        if col.lower() in [a.lower() for a in COLUMN_ALIASES["latitude"]]:
            lat_col = col
        if col.lower() in [a.lower() for a in COLUMN_ALIASES["longitude"]]:
            lon_col = col
    
    return lat_col, lon_col
```

---

## 7. ì‹¤í–‰ ë°©ë²• (Execution)

### 7.1 ëª…ë ¹ì–´

```bash
# ê¸°ë³¸ ì‹¤í–‰
python src/step2_extract_coordinates.py

# í•œêµ­ ë²”ìœ„ ê²€ì¦ í™œì„±í™”
python src/step2_extract_coordinates.py --validate-korea

# ë¬´íš¨ ì¢Œí‘œ í¬í•¨ ì¶œë ¥
python src/step2_extract_coordinates.py --include-invalid
```

### 7.2 ì˜ˆìƒ ì¶œë ¥

```
[INFO] Starting Step 2: Coordinate Extraction
[INFO] Loading data from output/step1/cleaned_stores.csv
[INFO] Found coordinate columns: latitude, longitude
[INFO] Extracting coordinates... 1000 records
[INFO] Validating coordinates...
[INFO]   - Valid: 985 (98.5%)
[INFO]   - Invalid: 15 (1.5%)
[INFO] Saving results to output/step2/
[INFO] Step 2 completed in 12.5 seconds
```

---

## 8. ë‹¤ìŒ ë‹¨ê³„

- **ë‹¤ìŒ**: [04_STEP3_MATRIX.md](./04_STEP3_MATRIX.md) - ë§¤íŠ¸ë¦­ìŠ¤ ìƒì„±
- **ì´ì „**: [02_STEP1_DATA_LOADING.md](./02_STEP1_DATA_LOADING.md) - ë°ì´í„° ë¡œë”©
